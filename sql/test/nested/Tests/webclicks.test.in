statement ok
create type kv as (key varchar, value varchar)

statement ok
create type elem as (element kv)

statement ok
create type webusr as (list elem[])

statement ok
create type loc as (list elem[])

statement ok
create type actionfields as (list elem[])

statement ok
create type attributes as (list elem[])

statement ok
create type oelement as (type varchar, id varchar, attributes attributes)

statement ok
create type oelement_container as (element oelement)

statement ok
create type eobjects as (list oelement_container[])

statement ok
create type ecommerce as (name varchar, actionfields actionfields, objects eobjects)

statement ok
create type event as (
    eventid varchar,
    sessionid varchar,
    userid varchar,
    event varchar,
    timestamp timestamp,
    user_agent varchar,
    location loc, 
    "user" webusr,
    ecommerce ecommerce)

query I
select count(*) from r'/tmp/webclicks.json'
----
2

query TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
select cast(t.json as event) from (select json from r'/tmp/webclicks.json') t
----

# clean up
statement ok
drop type event

statement ok
drop type loc

statement ok
drop type webusr

statement ok
drop type ecommerce

statement ok
drop type actionfields

statement ok
drop type attributes

statement ok
drop type eobjects

statement ok
drop type elem

statement ok
drop type kv

