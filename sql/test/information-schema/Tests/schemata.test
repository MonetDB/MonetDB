query TTTTTTT rowsort
SELECT
  CATALOG_NAME,
  SCHEMA_NAME,
  SCHEMA_OWNER,
  DEFAULT_CHARACTER_SET_CATALOG,
  DEFAULT_CHARACTER_SET_SCHEMA,
  DEFAULT_CHARACTER_SET_NAME,
  SQL_PATH
FROM INFORMATION_SCHEMA.SCHEMATA
WHERE SCHEMA_NAME = 'information_schema'
----
NULL
information_schema
monetdb
NULL
NULL
UTF-8
NULL

-- check for NULL and empty string value violations on NOT NULL columns
query TTTTTTTIIT rowsort
SELECT
  CATALOG_NAME,
  SCHEMA_NAME,
  SCHEMA_OWNER,
  DEFAULT_CHARACTER_SET_CATALOG,
  DEFAULT_CHARACTER_SET_SCHEMA,
  DEFAULT_CHARACTER_SET_NAME,
  SQL_PATH,
  schema_id,
  is_system,
  comments
FROM INFORMATION_SCHEMA.SCHEMATA
WHERE SCHEMA_NAME IS NULL
   OR SCHEMA_NAME = ''
   OR SCHEMA_OWNER IS NULL
   OR SCHEMA_OWNER = ''
   OR DEFAULT_CHARACTER_SET_NAME IS NULL
   OR DEFAULT_CHARACTER_SET_NAME = ''
   OR schema_id IS NULL
   OR is_system IS NULL
----

-- entity integrity checks
query ITT rowsort
SELECT COUNT(*) AS duplicates, CATALOG_NAME, SCHEMA_NAME
 FROM INFORMATION_SCHEMA.SCHEMATA
 GROUP BY CATALOG_NAME, SCHEMA_NAME
 HAVING COUNT(*) > 1
----

-- as CATALOG_NAME is always NULL, SCHEMA_NAME alone should be unique also
query IT rowsort
SELECT COUNT(*) AS duplicates, SCHEMA_NAME
 FROM INFORMATION_SCHEMA.SCHEMATA
 GROUP BY SCHEMA_NAME
 HAVING COUNT(*) > 1
----

-- schema_id alone should be unique also
query II rowsort
SELECT COUNT(*) AS duplicates, schema_id
 FROM INFORMATION_SCHEMA.SCHEMATA
 GROUP BY schema_id
 HAVING COUNT(*) > 1
----

-- referential integrity checks
query TT rowsort
SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME
 FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE (DEFAULT_CHARACTER_SET_CATALOG, DEFAULT_CHARACTER_SET_SCHEMA, DEFAULT_CHARACTER_SET_NAME)
 NOT IN (SELECT CHARACTER_SET_CATALOG, CHARACTER_SET_SCHEMA, CHARACTER_SET_NAME FROM INFORMATION_SCHEMA.CHARACTER_SETS)
----

-- as DEFAULT_CHARACTER_SET_CATALOG is always NULL leave it out of the check
query TT rowsort
SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME
 FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE (DEFAULT_CHARACTER_SET_SCHEMA, DEFAULT_CHARACTER_SET_NAME)
 NOT IN (SELECT CHARACTER_SET_SCHEMA, CHARACTER_SET_NAME FROM INFORMATION_SCHEMA.CHARACTER_SETS)
----

-- as DEFAULT_CHARACTER_SET_CATALOG and DEFAULT_CHARACTER_SET_SCHEMA are always NULL leave it out of the check
query TT rowsort
SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME
 FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE (DEFAULT_CHARACTER_SET_NAME)
 NOT IN (SELECT CHARACTER_SET_NAME FROM INFORMATION_SCHEMA.CHARACTER_SETS)
----

-- check schema_id reference
query TI rowsort
SELECT SCHEMA_NAME, schema_id
 FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE (schema_id) NOT IN (SELECT id FROM sys.schemas)
----

-- check is_system allowed boolean values
query TI rowsort
SELECT SCHEMA_NAME, is_system
 FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE is_system NOT IN (FALSE, TRUE)
----

