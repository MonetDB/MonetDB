statement ok
START TRANSACTION

statement ok
create procedure "sys"."dict_compress"(sname string, tname string, cname string) external name "dict"."compress"

statement ok
create procedure "sys"."dict_compress"(sname string, tname string, cname string, ordered_values bool) external name "dict"."compress"

statement ok
create procedure "sys"."for_compress"(sname string, tname string, cname string) external name "for"."compress"

statement ok
COMMIT

statement ok
START TRANSACTION

statement ok
CREATE TABLE "mct20" ("c0" INTERVAL DAY,"c1" BIGINT,CONSTRAINT "mct20_c1_pkey" PRIMARY KEY ("c1"))

statement ok
INSERT INTO "mct20" VALUES (INTERVAL '0' SECOND, 0), (INTERVAL '777600' SECOND, 1), (INTERVAL '604800' SECOND, 2)

statement ok
CREATE TABLE "mct21" ("c0" INTERVAL DAY,"c1" BIGINT,CONSTRAINT "mct21_c1_pkey" PRIMARY KEY ("c1"))

statement ok
INSERT INTO "mct21" VALUES (INTERVAL '-2' SECOND, -6), (INTERVAL '86400' SECOND, 7), (INTERVAL '-2' SECOND, 8)

statement ok
COMMIT

statement ok
CALL "sys"."for_compress"('sys','mct20','c1')

statement error GDK reported error: BATsubcross: more than one match
UPDATE mct20 SET c1 = mct20.c1 FROM mct21

statement ok
START TRANSACTION

statement ok
DROP TABLE "mct20"

statement ok
DROP TABLE "mct21"

statement ok
COMMIT

statement ok
START TRANSACTION

statement ok
CREATE TABLE "t1" ("c0" UUID,"c1" SMALLINT NOT NULL)

statement ok rowcount 9
COPY 9 RECORDS INTO "t1" FROM stdin USING DELIMITERS E'\t',E'\n','"'
<COPY_INTO_DATA>
c036a4cf-ecec-57d1-9aca-6dce4eb8d12b	5
df1bcbac-01e3-81bc-a7c2-c2769fc9751a	0
NULL	7
NULL	9
NULL	1
NULL	3
bb4fb0da-aff1-1919-f4eb-abaaf9e6b1f7	6
648be74d-ccff-ea44-fd64-dfcb3a8c5b6c	8
fb7c955a-defd-1b91-0aca-aecfc8a0c5aa	2

statement ok
CREATE TABLE "t0" ("c0" BIGINT NOT NULL)

statement ok rowcount 11
COPY 11 RECORDS INTO "sys"."t0" FROM stdin USING DELIMITERS E'\t',E'\n','"'
<COPY_INTO_DATA>
1
5
3
8
-1
9
4
2
6
0
7

statement ok
COMMIT

statement ok
CALL "sys"."dict_compress"('sys','t0','c0',false)

statement ok rowcount 11
INSERT INTO t1(c0, c1)(SELECT UUID '7A4A6b8b-e7f9-FA09-5650-6d1c83B1fc69', t0.c0 FROM t0)

query I rowsort
SELECT c0 FROM t0
----
-1
0
1
2
3
4
5
6
7
8
9

query TI rowsort
SELECT c0,c1 FROM t1
----
648be74d-ccff-ea44-fd64-dfcb3a8c5b6c
8
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
-1
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
0
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
1
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
2
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
3
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
4
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
5
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
6
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
7
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
8
7a4a6b8b-e7f9-fa09-5650-6d1c83b1fc69
9
NULL
1
NULL
3
NULL
7
NULL
9
bb4fb0da-aff1-1919-f4eb-abaaf9e6b1f7
6
c036a4cf-ecec-57d1-9aca-6dce4eb8d12b
5
df1bcbac-01e3-81bc-a7c2-c2769fc9751a
0
fb7c955a-defd-1b91-0aca-aecfc8a0c5aa
2

statement ok
START TRANSACTION

statement ok
DROP TABLE "t0"

statement ok
DROP TABLE "t1"

statement ok
COMMIT

statement ok
CREATE TABLE t2(c0 INTERVAL DAY)

statement ok
CALL "sys"."dict_compress"('sys','t2','c0')

statement ok rowcount 3
INSERT INTO t2(c0) VALUES(INTERVAL '1586894108' DAY), (INTERVAL '-1000818987' DAY), (INTERVAL '1839469049' DAY)

statement ok rowcount 3
DELETE FROM t2

statement ok rowcount 1
INSERT INTO t2(c0) VALUES(INTERVAL '744537356' DAY)

query T nosort
SELECT c0 FROM t2
----
744537356

statement ok
DROP TABLE "t2"

statement ok
CREATE TABLE t2(c0 JSON, c1 BIGINT, c2 CHAR(71))

statement ok
CALL "sys"."dict_compress"('sys','t2','c1')

statement ok rowcount 2
INSERT INTO t2(c2, c0) VALUES('', JSON '["aa","tyu"]'), ('a', JSON '0.4')

statement ok rowcount 2
INSERT INTO t2(c0) VALUES(JSON '[false,false]'), (JSON 'null')

statement ok rowcount 4
UPDATE t2 SET c1 = 1

query TIT rowsort
SELECT c0, c1, c2 FROM t2
----
0.4
1
a
["aa","tyu"]
1
(empty)
[false,false]
1
NULL
null
1
NULL

statement ok
DROP TABLE "t2"

statement ok
CREATE TABLE t1(c0 VARCHAR(263))

statement ok
CALL "sys"."dict_compress"('sys','t1','c0',true)

statement ok rowcount 2
INSERT INTO t1(c0) VALUES('2104954476'), ('-1781832249')

statement ok
ALTER TABLE t1 ADD CONSTRAINT con2 UNIQUE(c0)

query T rowsort
SELECT c0 FROM t1
----
-1781832249
2104954476

statement ok
DROP TABLE "t1"

statement ok
START TRANSACTION

statement ok
CREATE SEQUENCE "sys"."seq_8393" AS INTEGER

statement ok
CREATE TABLE "sys"."t0" ("c0" DECIMAL(18,3),"c1" BIGINT DEFAULT next value for "sys"."seq_8393")

statement ok rowcount 35
COPY 35 RECORDS INTO "sys"."t0" FROM stdin USING DELIMITERS E'\t',E'\n','"'
<COPY_INTO_DATA>
0.869	-1519170928
0.755	34
0.690	-500094807
NULL	-1007149659
NULL	-1182606787
0.978	2141158291
0.734	1
0.757	2
0.685	3
0.876	4
0.237	5
NULL	6
0.998	643115392
0.395	-1477930933
0.163	7
0.049	-1127189901
0.069	-1127508051
6.000	1895794951
0.963	-711543940
0.808	-1
0.722	-9223372036854775807
0.616	8
NULL	1896254920
0.352	9
0.135	0
0.306	10
NULL	44
NULL	-68731387
NULL	-259682535
NULL	-413188411
NULL	2060626791
NULL	-1819302001
0.353	1671526830
NULL	49
NULL	5989

statement ok
ALTER SEQUENCE "sys"."seq_8393" RESTART WITH 11 NO CYCLE

statement ok
COMMIT

statement ok
CALL "sys"."dict_compress"('sys','t0','c1',true)

statement ok rowcount 2
INSERT INTO t0(c1) VALUES(1419068893), (least(json."integer"(JSON 'null'), sqrt((SELECT DISTINCT 421689172 WHERE TRUE))))

statement ok rowcount 37
UPDATE t0 SET c1 = DEFAULT

statement ok rowcount 24
INSERT INTO t0(c1) VALUES(718095040), (-598203097), (0), (447346516), (1872246785), (-401674441), (-1541029518),(541285281),(-2111339894),(-2131974587),(-4855319),
(776811174),(419815752),(-872811856), (-1283391645),(1459537807), (716010206), (NULL), (131493150), (326028168), (-1959786633),(1432852950), (21), (-1830329263)

statement ok rowcount 35
INSERT INTO t0(c0) VALUES(3), (0.686), (0.454), (0.868),(0.686),(0.5), (0.353), (0.454), (0.54), (0.54), (0.342), (-969122634),(0.2), (0.5), (4),(0.342),
(0.7), (0.9), (0.57), (0.99), (0.5645),(0.342),(0.78), (0.86),(2), (0.46),(0.242), (0.66), (0.11),(0.686), (0.65), (0.65), (1), (0.53), (0.454)

statement ok rowcount 12
INSERT INTO t0(c0, c1) VALUES(0.2342, 1313410006), (2, 1669659098), (0.45, 512732037), (0.768, -1635964182), (0.68, 2),(0.9, DEFAULT), (0.354, -860428240),
(0.45, -2077612165),(0.54, 114),(0.585, -766044021), (0.646, -760724786), (0.33, 519176898)

statement ok rowcount 5
INSERT INTO t0(c1, c0) VALUES(-1226601715, 0.545), (313, 0.68),(1613852187, 0.234),(1296111754, 0.75),(-1806857005, 0.767)

statement ok
UPDATE t0 SET c1 = DEFAULT FROM (SELECT 1) x(x)

statement ok
DROP TABLE t0

statement ok
CREATE TABLE t1(c0 STRING, c1 boolean)

statement ok
CALL "sys"."dict_compress"('sys','t1','c1')

statement ok rowcount 8
INSERT INTO "sys"."t1" VALUES ('488630434', true),('7', NULL),('-', NULL),('1663155929', NULL),('0.513881723571404', NULL),('_', false),('8277e0910d750195b448797616e091ad', NULL),('16:57:59', NULL)

query T nosort
SELECT t1.c0 FROM t1 WHERE NOT (t1.c1)
----
_

query I nosort
SELECT CAST(SUM(count) AS BIGINT) FROM (SELECT CAST(NOT (t1.c1) AS INT) as count FROM t1) as res
----
1

statement ok
DROP TABLE t1

statement ok
START TRANSACTION

statement ok
CREATE TABLE rmct20(c0 BIGINT)

statement ok
CREATE TABLE rmct21(c0 BIGINT)

statement ok rowcount 3
INSERT INTO rmct20(c0) VALUES(40000), (26857000), (127117816000)

statement ok rowcount 9
INSERT INTO rmct21(c0) VALUES(1510153480000),(1054357633000),(93000),(542168641000),(1963352769000),(855906053000),(1937466219000),(27000),(875025185000)

statement ok
COMMIT

statement ok
CALL "sys"."dict_compress"('sys','rmct21','c0',true)

statement ok rowcount 4
INSERT INTO rmct21(c0) VALUES(1829991355000),(2073175664000),(1969480299000),(1534889714000)

query T rowsort
(SELECT greatest(rmct21.c0, rmct21.c0) FROM rmct21) INTERSECT ALL (SELECT DISTINCT sql_max(737555899, rmct21.c0) FROM rmct21)
----
1054357633000
1510153480000
1534889714000
1829991355000
1937466219000
1963352769000
1969480299000
2073175664000
542168641000
855906053000
875025185000

statement ok
START TRANSACTION

statement ok
DROP TABLE rmct20

statement ok
DROP TABLE rmct21

statement ok
COMMIT

statement ok
START TRANSACTION

statement ok
CREATE TABLE "t0" ("c0" INET)

statement ok rowcount 18
INSERT INTO "t0" VALUES ('164.82.81.89'),('113.147.23.38'),('86.149.73.111'),('181.250.179.49/28'),('194.195.10.124/2'),('73.161.236.158'),('10.30.207.106'),
('70.12.16.242/26'),('202.52.196.246/20'),('208.167.107.137'),('31.108.174.206'),('103.74.10.64/29'),('230.91.255.3/25'),('128.184.144.74'),('72.63.75.16/22'),
('23.39.29.46/31'),('35.154.241.4/10'),('97.134.228.106/31')

statement ok
CREATE TABLE "t1" ("c0" INET)

statement ok rowcount 13
INSERT INTO "t1" VALUES ('58.166.167.234/4'),('17.41.170.78'),(NULL),('125.66.199.214'),('31.72.22.103/13'),('177.199.200.115'),('140.247.168.238/24'),
('175.250.175.86/17'),('16.63.246.44'),('54.110.196.2/0'),('208.9.31.24/0'),('119.47.128.18'),('5.250.95.199/28')

statement ok
COMMIT

statement ok
CALL "dict_compress"('sys','t1','c0',false)

statement error MERGE DELETE: Multiple rows in the input relation match the same row in the target table 'sys.t1'
MERGE INTO t1 USING (SELECT DISTINCT 0.3, sys."network"(t1.c0) FROM t1) AS mergejoined(c0,c1) ON TRUE WHEN MATCHED THEN UPDATE SET c0 = INET '56.157.166.36';

statement ok
START TRANSACTION

statement ok
DROP TABLE t0

statement ok
DROP TABLE t1

statement ok
COMMIT

statement ok
START TRANSACTION

statement ok
DROP ALL PROCEDURE "sys"."dict_compress"

statement ok
DROP ALL PROCEDURE "sys"."for_compress"

statement ok
COMMIT

