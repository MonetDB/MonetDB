@' The contents of this file are subject to the MonetDB Public
@' License Version 1.0 (the "License"); you may not use this file
@' except in compliance with the License. You may obtain a copy of
@' the License at
@' http://monetdb.cwi.nl/Legal/MonetDBLicense-1.0.html
@'
@' Software distributed under the License is distributed on an "AS
@' IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
@' implied. See the License for the specific language governing
@' rights and limitations under the License.
@'
@' The Original Code is the Monet Database System.
@'
@' The Initial Developer of the Original Code is CWI.
@' Portions created by CWI are Copyright (C) 1997-2005 CWI.
@' All Rights Reserved.

@f sql_backend
@a N.J. Nes
@* 
The back end structure collects the information needed to support
compilation and execution of the SQL code against a back-end engine.
Note that any back-end can be called upon by the front-end
to handle specific tasks, such as catalog management (sql_mvc)
and query execution (sql_qc). For this purpose, the front-end needs
access to operations defined in the back-end, in particular for
freeing the stack and code segment.

The front-end should not rely on knowledge how the back end handles 
the actual query processing. Using the sample back ends Monet4 and Monet5
are used to find the common ground here. The structure currently is a
simple functional wrapper. It assumes that a single back-end is used
for the duration of a session.
@{
@h
#ifndef _SQL_BACKEND_H_
#define _SQL_BACKEND_H_

#include "sql_mem.h"
#include "sql_catalog.h"

typedef void (*freestack_fptr)( backend_stack stk );
typedef void (*freecode_fptr)( backend_code code, backend_stack stk, int nr );
typedef void (*interpret_fptr)( backend_stack stk, char *code );
	
sqlcommon_export void backend_init( freestack_fptr fstack, freecode_fptr fcode,
		   interpret_fptr finterpret );
sqlcommon_export void backend_freestack( backend_stack stk );
sqlcommon_export void backend_freecode( backend_code code, backend_stack stk, int nr);
sqlcommon_export void backend_interpret( backend_stack stk, char *code);

#endif /* _SQL_BACKEND_H_ */
@c

#include "sql_backend.h"

static freestack_fptr _fstack = NULL;
static freecode_fptr  _fcode = NULL;
static interpret_fptr  _finterpret = NULL;

void backend_init( freestack_fptr fstack, freecode_fptr fcode, 
		   interpret_fptr finterpret )
{
	_fstack = fstack;
	_fcode = fcode;
	_finterpret = finterpret;
}

void backend_freestack( backend_stack stk )
{
	if (_fstack)
		_fstack(stk);
}

void backend_freecode( backend_code code, backend_stack stk, int nr )
{
	if (_fcode)
		_fcode(code, stk, nr);
}

void backend_interpret( backend_stack stk, char *code )
{
	if (_finterpret)
		_finterpret(stk, code);
}
@}
