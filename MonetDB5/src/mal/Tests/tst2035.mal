#The 2000 serie  is focussed on parallelism

function clkticks(n:int):void;
barrier	b:= n>0;
	printf("#clock tick %d\n",n);
	alarm.sleep(3);
	n:= n-1;
	redo b:= n>0;
exit	b;
end clkticks;

counter:=0;
thread 	hdl:=0;	# synchronize through a counter
	print("#start the child");
	clkticks(1);
	counter:= counter+1;
	printf("#counter %d\n",counter);
barrier t:= counter==2;
	leave hdl;
exit	t;
	printf("#Redo thread\n");
	redo hdl;
exit	hdl;

printf("#Main thread\n");
# loop to wait for the child to exit
barrier wl:= true;
	printf("#Wait for child to exit %d\n",hdl);
barrier	t0:=counter == 2;
	printf("#Child died \n");
	leave wl;
exit	t0;
	alarm.sleep(10);
	redo wl;
exit	wl;
