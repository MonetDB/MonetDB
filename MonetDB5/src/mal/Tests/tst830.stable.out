stdout of test 'tst830` in directory 'src/mal` itself:


# 20:34:17 >  
# 20:34:17 >  Mtimeout -timeout 60 mserver "--config=/ufs/mk/monet5/src/mal/Tests/All.conf" --debug=10 --set "monet_mod_path=/ufs/mk/monet5/Linux/lib/MonetDB5:/ufs/mk/opensource/MonetDB/Linux/lib/MonetDB" --set "gdk_dbfarm=/ufs/mk/opensource/MonetDB/Linux/var/MonetDB5/dbfarm" --set "sql_logdir=/ufs/mk/opensource/MonetDB/Linux/var/MonetDB5/log" --set mapi_port=36259 --set sql_port=40419 --set xquery_port=52492 --set monet_prompt= --trace "--config=/ufs/mk/monet5/src/mal/Tests/All.conf" --dbname=mTests_src_mal  tst830.mal < /dev/null
# 20:34:17 >  





# MonetDB Server v4.99.19
# Copyright (c) 1993-2006 CWI, all rights reserved
# Compiled for x86_64-redhat-linux-gnu/64bit with 64bit OIDs dynamically linked
# config:/ufs/fabian/scratch/monetdb/five/program-x86_64/etc/MonetDB5.conf
# dbfarm:/net/pegasus.ins.cwi.nl/export/scratch0/fabian/vtmp/mtest-five-monetdb-pegasus.ins.cwi.nl/monetdb/dbfarm
# dbname:mTests_src_mal
# Visit http://monetdb.cwi.nl/ for further information.
## a simple functional test for the access control table
#
#u:= clients.getPermissions();
#io.print(u);
#
#clients.addUser("monetdb","Pmonetdb","sql");
#clients.addUser("monetdb","Pmonetdb","mal");
#clients.addUser("checkpoint","Pcheckpoint","mal");
#clients.addUser("legacy","Plegacy","mil");
#
#u:= clients.getPermissions();
#p:= clients.getPasswords();
#io.print(u,p);
#
#clients.delUser("checkpoint");
#clients.delUser("monetdb","mal");
#u:= clients.getPermissions();
#io.print(u);
#
#t:= clients.checkPermission("monetdb","Pmonetdb","sql");
#io.print(t);
#
#t:= clients.checkPermission("monetdb","x","sql");
#io.print(t);
#
#t:= clients.checkPermission("monetdb","Pmonetdb","x");
#io.print(t);
#
#t:= clients.checkPermission("x","Pmonetdb","sql");
#io.print(t);
#
#
function user.main():void;	# 0  (main:void)
# a simple functional test for the access control table 	# 1  (_1:str)
    scens := bat.new(:str,:void);	# 2 CMDBATnew (scens:bat[:str,:void])<-(_3:str)(_4:void)
    bat.insert(scens,"sql",nil:void);	# 3 BKCinsert_bun (_5:void)<-(scens:bat[:str,:void])(_6:str)(_7:void)
    bat.insert(scens,"mal",nil:void);	# 4 BKCinsert_bun (_8:void)<-(scens:bat[:str,:void])(_9:str)(_7:void)
# this should fail, the monetdb user is already there 	# 5  (_10:str)
    id := clients.addUser("monetdb","Pmonetdb",scens);	# 6 CLTaddUser (id:oid)<-(_12:str)(_13:str)(scens:bat[:str,:void])
catch MALException:str ;	# 7  (MALException:str) jump 9
    io.printf(MALException);	# 8 IOprint_str (_15:void)<-(MALException:str)
exit MALException:str ;	# 9  (MALException:str)
# should print 0@1 or something 	# 10  (_16:str)
    id := clients.addUser("test","test",scens);	# 11 CLTaddUser (id:oid)<-(_17:str)(_17:str)(scens:bat[:str,:void])
    io.print(id);	# 12 IOprint_val (_18:void)<-(id:oid)
# this should work also 	# 13  (_19:str)
# don't use nil:bat[:str, :void] here, it results in a crash 	# 14  (_20:str)
    t := bat.new(:str,:void);	# 15 CMDBATnew (t:bat[:str,:void])<-(_22:str)(_4:void)
    id := clients.addUser("checkpoint","Pcheckpoint",t);	# 16 CLTaddUser (id:oid)<-(_23:str)(_24:str)(t:bat[:str,:void])
    io.print(id);	# 17 IOprint_val (_25:void)<-(id:oid)
# do a simple listing of users known 	# 18  (_26:str)
    u := clients.getUsers(t);	# 19 CLTgetUsers (u:bat[:oid,:str])<-(t:bat[:str,:void])
    io.print(u);	# 20 IOprint_val (_28:void)<-(u:bat[:oid,:str])
    bat.insert(t,"mal",nil:void);	# 21 BKCinsert_bun (_29:void)<-(t:bat[:str,:void])(_9:str)(_7:void)
    bat.insert(t,"sql",nil:void);	# 22 BKCinsert_bun (_30:void)<-(t:bat[:str,:void])(_6:str)(_7:void)
    u := clients.getUsers(t);	# 23 CLTgetUsers (u:bat[:oid,:str])<-(t:bat[:str,:void])
    io.print(u);	# 24 IOprint_val (_31:void)<-(u:bat[:oid,:str])
# should work, we're the admin here 	# 25  (_32:str)
    clients.removeUser("checkpoint");	# 26 CLTremoveUser (_33:void)<-(_23:str)
# do a simple listing of users known 	# 27  (_26:str)
    u := clients.getUsers(t);	# 28 CLTgetUsers (u:bat[:oid,:str])<-(t:bat[:str,:void])
    io.print(u);	# 29 IOprint_val (_34:void)<-(u:bat[:oid,:str])
# just remove the scenarios one by one, should work 	# 30  (_35:str)
    clients.removeScenario("test","mal");	# 31 CLTremoveScenario (_36:void)<-(_17:str)(_9:str)
    clients.removeScenario("test","sql");	# 32 CLTremoveScenario (_37:void)<-(_17:str)(_6:str)
# this one should fail: it's not there 	# 33  (_38:str)
    clients.removeScenario("test","mil");	# 34 CLTremoveScenario (_39:void)<-(_17:str)(_40:str)
catch MALException:str ;	# 35  (MALException:str) jump 37
    io.printf(MALException);	# 36 IOprint_str (_41:void)<-(MALException:str)
exit MALException:str ;	# 37  (MALException:str)
# and add a scenario again 	# 38  (_42:str)
    clients.addScenario("test","mal");	# 39 CLTaddScenario (_43:void)<-(_17:str)(_9:str)
# do it again, see what happens (should fail) 	# 40  (_44:str)
    clients.addScenario("test","mal");	# 41 CLTaddScenario (_45:void)<-(_17:str)(_46:str)
catch MALException:str ;	# 42  (MALException:str) jump 44
    io.printf(MALException);	# 43 IOprint_str (_47:void)<-(MALException:str)
exit MALException:str ;	# 44  (MALException:str)
# forcefully set the password of the user test 	# 45  (_48:str)
    clients.setPassword("test","newpass");	# 46 CLTsetPassword (_49:void)<-(_17:str)(_50:str)
# now try to set the password for ourself, should fail 	# 47  (_51:str)
    clients.setPassword("monetdb","badpass");	# 48 CLTsetPassword (_52:void)<-(_53:str)(_54:str)
catch InvalidCredentialsException:str ;	# 49  (InvalidCredentialsException:str) jump 51
    io.printf(InvalidCredentialsException);	# 50 IOprint_str (_56:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 51  (InvalidCredentialsException:str)
# change our own password 	# 52  (_57:str)
    clients.changePassword("monetdb","newdb");	# 53 CLTchangePassword (_58:void)<-(_53:str)(_59:str)
# try it again, should fail... 	# 54  (_60:str)
    clients.changePassword("monetdb","newdb");	# 55 CLTchangePassword (_61:void)<-(_53:str)(_59:str)
catch InvalidCredentialsException:str ;	# 56  (InvalidCredentialsException:str) jump 58
    io.printf(InvalidCredentialsException);	# 57 IOprint_str (_62:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 58  (InvalidCredentialsException:str)
# all should fail 	# 59  (_63:str)
    clients.checkPermission("monetdb","Pmonetdb","sql");	# 60 CLTcheckPermission (_64:void)<-(_53:str)(_65:str)(_66:str)
catch InvalidCredentialsException:str ;	# 61  (InvalidCredentialsException:str) jump 63
    io.printf(InvalidCredentialsException);	# 62 IOprint_str (_67:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 63  (InvalidCredentialsException:str)
    clients.checkPermission("monetdb","x","sql");	# 64 CLTcheckPermission (_68:void)<-(_53:str)(_69:str)(_66:str)
catch InvalidCredentialsException:str ;	# 65  (InvalidCredentialsException:str) jump 67
    io.printf(InvalidCredentialsException);	# 66 IOprint_str (_70:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 67  (InvalidCredentialsException:str)
    clients.checkPermission("monetdb","Pmonetdb","x");	# 68 CLTcheckPermission (_71:void)<-(_53:str)(_65:str)(_69:str)
catch InvalidCredentialsException:str ;	# 69  (InvalidCredentialsException:str) jump 71
    io.printf(InvalidCredentialsException);	# 70 IOprint_str (_72:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 71  (InvalidCredentialsException:str)
    clients.checkPermission("x","Pmonetdb","sql");	# 72 CLTcheckPermission (_73:void)<-(_69:str)(_65:str)(_66:str)
catch InvalidCredentialsException:str ;	# 73  (InvalidCredentialsException:str) jump 75
    io.printf(InvalidCredentialsException);	# 74 IOprint_str (_74:void)<-(InvalidCredentialsException:str)
exit InvalidCredentialsException:str ;	# 75  (InvalidCredentialsException:str)
end main;	# 76  
MALException:user.main[6]:addUser:user 'monetdb' already exists
[ 1@0 ]
[ 2@0 ]
#-------------------------#
# h	t		  # name
# void	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 1@0,	  "test"	  ]
[ 2@0,	  "checkpoint"	  ]
#-------------------------#
# h	t		  # name
# oid	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 2@0,	  "checkpoint"	  ]
[ 1@0,	  "test"	  ]
#-------------------------#
# h	t		  # name
# oid	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 1@0,	  "test"	  ]
MALException:user.main[34]:removeScenario:scenario 'mil' not found for user 'test'
MALException:user.main[39]:addScenario:scenario 'mal' already exists for user 'test'
InvalidCredentialsException:user.main[48]:setPassword:The administrator cannot set its own password, use changePassword instead
InvalidCredentialsException:user.main[53]:changePassword:Access denied
InvalidCredentialsException:user.main[60]:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:user.main[64]:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:user.main[68]:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:user.main[72]:checkCredentials:Invalid credentials for user 'x'

# 20:34:17 >  
# 20:34:17 >  Done.
# 20:34:17 >  

