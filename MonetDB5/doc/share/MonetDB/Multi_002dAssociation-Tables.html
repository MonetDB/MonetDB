<html lang="en">
<head>
<title>Multi-Association Tables - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Optimizer-toolkit.html#Optimizer-toolkit" title="Optimizer toolkit">
<link rel="prev" href="Code-Factorization.html#Code-Factorization" title="Code Factorization">
<link rel="next" href="Partitioned-Databases.html#Partitioned-Databases" title="Partitioned Databases">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: June 5, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Multi-Association-Tables"></a>
<a name="Multi_002dAssociation-Tables"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Partitioned-Databases.html#Partitioned-Databases">Partitioned Databases</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Code-Factorization.html#Code-Factorization">Code Factorization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Optimizer-toolkit.html#Optimizer-toolkit">Optimizer toolkit</a>
<hr>
</div>

<h3 class="section">13.12 Multiple Association Tables</h3>

<p>A Multi Association Table descriptor (MAT) defines an ordered collection
of type compatible BATs, whose union represents a single (virtual) BAT. 
The MAT may relate to a partitioned BAT, but could also be an arbitrary
collection of temporary BATs within a program fragment.

   <p>The MAT definition lives within the scope of a single block. 
The MAT optimizer simply expands the plan to
deal with its components on an individual basis. 
Only when a blocking or aggregate operator is encounted,
the underlying BAT is materialized.

   <p>The MAT object can not be passed as an argument to any function
without first being materialized. Simply because
the MAT is not known by the type system and none of the lower
level operations is currently aware of their existence.

   <p>In the first approach of the MAT optimizer we assume that the
last BAT in the MAT sequence is used as an accumulator. 
Furthermore, no semantic knowledge is used to reduce the
possible superflous (semi)joins. Instead, we limit expansion
to a single argument. The last one in the argument list. 
This is changed at a later stage when a cost-based evaluation
be decide differently.

   <p>To illustrate, consider
<pre class="example">         m0:= bat.new(:void,:int);
     	m1:= bat.new(:void,:int);
     	m2:= bat.new(:void,:int);
     	b := mat.new(m0,m1,m2);
     	s := algebra.select(b,1,3);
     	i := algebra.count(s);
     	io.print(s);
     	io.print(i);
     	c0 := bat.new(:int,:int);
     	c1 := bat.new(:int,:int);
     	c := mat.new(c0,c1);
     	j := algebra.join(b,s);
     	io.print(j);
</pre>
   <p>The selection and aggregate operations can simply be rewritten into a MAT.
<pre class="example">     	_33 := algebra.select(m0,1,3);
     	_34 := algebra.select(m1,1,3);
     	_35 := algebra.select(m2,1,3);
         s := mat.new(_33,_34,_35);
         i := 0;
         _36 := aggr.count(_33);
         i := calc.+(i,_36);
         _37 := aggr.count(_34);
         i := calc.+(i,_37);
         _38 := aggr.count(_35);
         i := calc.+(i,_38);
         io.print(i);
</pre>
   <p>The print operation does not have MAT semantics yet, which
calls for collection of the MAT components in a single BAT first.
<pre class="example">         s := mat.pack(_33,_34,_35);
         io.print(s);
</pre>
   <p>For the join we have to generate all possible combinations,
not knowing anything about the properties of the components. 
The current heuristic is to limit expansion to a single
argument. This leads to
<pre class="example">         b := mat.pack(m0,m1,m2);
         _39 := algebra.join(b,c0);
         _40 := algebra.join(b,c1);
         j := mat.new(_39,_40);
</pre>
   <p>The drawback of this scheme is the explosion in MAL statements. 
It is choosen as a basis for experimentation. In a fullblown
system we would also use iterators to avoid it.

<pre class="example"></pre>
   </body></html>

