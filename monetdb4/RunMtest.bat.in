@echo off

if not "%1"=="" goto skip
call %0 -rq
goto end

:skip

setlocal

set pkg=monetdb4
set buildbase=@XBUILD@
set builddir=%buildbase%\monetdb4
set srcdir=@XSOURCE@\monetdb4

set MOD_PATH=%builddir%\modules\plain\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\modules\plain
set MOD_PATH=%MOD_PATH%;%builddir%\modules\contrib\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\modules\contrib
set MOD_PATH=%MOD_PATH%;%builddir%\modules\calibrator\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\modules\calibrator
set MOD_PATH=%MOD_PATH%;%builddir%\modules\mapi\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\modules\mapi
set MOD_PATH=%MOD_PATH%;%builddir%\modules\mnetcdf\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\modules\mnetcdf
set MOD_PATH=%MOD_PATH%;%srcdir%\scripts\tools

set PATH=%buildbase%\clients\mapiclient;%buildbase%\clients\examples\C;%buildbase%\clients\examples\php;%buildbase%\clients\examples\python;%buildbase%\clients\perl\Tests;%buildbase%\testing;%PATH%

set PATH=%MOD_PATH%;%PATH%
set PATH=%builddir%\monet;%PATH%
set PATH=%builddir%\tools;%PATH%

set PYTHONPATH=%buildbase%\clients\python\build\lib;%buildbase%\testing;%srcdir%\..\testing;%PYTHONPATH%

set CLASSPATH=%buildbase%\java;%buildbase%\java\tests;%CLASSPATH%

set perlib=%buildbase%\clients\perl;%srcdir%\..\clients\perl
set PERLLIB=%perlib%;%PERLLIB%
set PERL5LIB=%perlib%;%PERL5LIB%

REM execute Mtest.py in the source directory
pushd %srcdir%

call "%buildbase%\testing\Mtest.py" "--config=%builddir%\conf\MonetDB.conf" --package=%pkg% "--monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" "--TSTTRGBASE=%builddir%" %*

popd
endlocal

:end
