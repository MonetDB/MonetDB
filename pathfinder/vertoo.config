# -*- mode: python -*-
addScheme('normal', '%major.%minor.%release')

main = addModule('pathfinder')
monetdb = addModule('MonetDB')
clients = addModule('clients')
monetdb4 = addModule('MonetDB4')
monetdb5 = addModule('MonetDB5')

# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes

main.setVersionFormat('@normal')
main.addAnchor("VERSION", "%v")
main.addAnchor("configure.ag", "[MonetDB XQuery], [%v]")
main.addAnchor("NT/rules.msc", "VERSION = %v")
main.addAnchor("runtime/xrpc/admin/title.html.in", "MonetDB/XQuery %v")
main.addAnchor("runtime/pathfinder.mx", "MonetDB/XQuery module v%v")
main.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"),
                arguments(pattern = '"Value" = "8:%v"',
                          format = '@normal'))
main.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery64.vdproj",
                arguments(pattern = '"ProductVersion" = "8:%v"',
                          format = "@normal"),
                arguments(pattern = '"Value" = "8:%v"',
                          format = '@normal'))
main.addAnchor("MonetDB-XQuery.spec", "%define version %v")

monetdb.setVersionFormat('@normal')
monetdb.addAnchor("configure.ag", "req_monetdb_ver=%q")
monetdb.addAnchors("MonetDB-XQuery.spec",
                   arguments(pattern = "\nBuildRequires: MonetDB-devel >= %v",
                             format = "%major.%minor"),
                   arguments(pattern = "\nRequires: MonetDB-devel >= %v",
                             format = "%major.%minor"))
monetdb.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery.vdproj",
                   arguments(pattern = r'"Condition" = "8:COMMONVERSION >= \"%v\""',
                             format = "@normal"))
monetdb.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery64.vdproj",
                   arguments(pattern = r'"Condition" = "8:COMMONVERSION >= \"%v\""',
                             format = "@normal"))

clients.setVersionFormat('@normal')
clients.addAnchor("configure.ag", "req_clients_ver=%q")

monetdb4.setVersionFormat('@normal')
monetdb4.addAnchor("configure.ag", "req_monetdb4_ver=%q")
monetdb4.addAnchor("INSTALL", "It depends on a version that is at least %v.")
monetdb4.addAnchors("MonetDB-XQuery.spec",
                    arguments(pattern = "\nRequires: MonetDB4-server >= %v",
                              format = "%major.%minor"),
                    arguments(pattern = "\nBuildRequires: MonetDB4-server-devel >= %v",
                              format = "%major.%minor"),
                    arguments(pattern = "\nRequires: MonetDB4-server-devel >= %v",
                              format = "%major.%minor"))
monetdb4.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery.vdproj",
                    arguments(pattern = r'"Condition" = "8:MONETDB4VERSION >= \"%v\""',
                             format = "@normal"))
monetdb4.addAnchors("NT/MonetDB4-XQuery/MonetDB4-XQuery64.vdproj",
                    arguments(pattern = r'"Condition" = "8:MONETDB4VERSION >= \"%v\""',
                             format = "@normal"))

monetdb5.setVersionFormat('@normal')
monetdb5.addAnchor("configure.ag", "req_monetdb5_ver=%q")
