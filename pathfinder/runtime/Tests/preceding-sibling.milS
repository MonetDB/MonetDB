module(pathfinder);

var ws := ws_create(0);
ws_opendoc(ws, bat(void,str,1).append("foo.xml"));
ws_opendoc(ws, bat(void,str,1).append("http://bstore1.example.com/bib.xml"));
                                                                                                                                                             
var iter := bat(void,oid).seqbase(0@0).append(1@0).append(1@0).append(1@0).append(2@0).append(2@0).append(3@0);
var item := bat(void,oid).seqbase(0@0).append(4@0).append(21@0).append(26@0).append(26@0).append(44@0).append(4@0);
var frag := bat(void,oid).seqbase(0@0).append(1@0).append(2@0).append(2@0).append(2@0).append(2@0).append(1@0);
item  := [oid]([+]([lng](item),1));
iter.access(BAT_READ);
item.access(BAT_READ);
frag.access(BAT_READ);
item := mposjoin(item, frag, ws.fetch(NID_RID));
                                                                                                                                                             
proc print_scj (bat[void,bat] scj) : void { print(scj.fetch(0), mposjoin(scj.fetch(1), scj.fetch(2), ws.fetch(PRE_NID)), scj.fetch(2)); }

loop_lifted_preceding_sibling_step(iter,item,frag,ws).print_scj();
loop_lifted_preceding_sibling_step_with_kind_test(iter,item,frag,ws,TEXT).print_scj();
loop_lifted_preceding_sibling_step_with_kind_test(iter,item,frag,ws,ELEMENT).print_scj();
loop_lifted_preceding_sibling_step_with_ns_test(iter,item,frag,ws,"").print_scj();
loop_lifted_preceding_sibling_step_with_loc_test(iter,item,frag,ws,"book").print_scj();
loop_lifted_preceding_sibling_step_with_nsloc_test(iter,item,frag,ws,"","b").print_scj();

