# init ()
module("aggrX3");
module("xtables");
module("malalgebra");
var loop000 := bat(void,oid).seqbase(0@0);
loop000.insert(0@0, 1@0);
var str_values := bat(void,str).seqbase(0@0).access(BAT_WRITE);
str_values.reverse().key(true);
var iter;
var pos;
var item;
var kind;
{
str_values.append ("foo");
var itemID := str_values.ord_uselect("foo");
itemID := itemID.reverse().fetch(0);
# translateConst (kind)
iter := loop000;
iter := iter.reverse().mark(0@0).reverse();
pos := iter.project(1@0);
item := iter.project(itemID);
kind := iter.project('s');
itemID := nil;
}
{ # getQName ()
        var nodes := kind.ord_uselect('n');
        nodes := nodes.mirror().leftfetchjoin(item);
        nodes := nodes.leftfetchjoin(Tpre_kind);
        var textNodes := nodes.ord_uselect(TEXT);
        nodes := nil;
        var strings_s2q := kind.ord_uselect('s');

        textNodes := textNodes.mirror().leftfetchjoin(item);
        textNodes := textNodes.leftfetchjoin(Tpre_prop);
        textNodes := textNodes.leftfetchjoin(Tprop_text);

        var oid_oid := strings_s2q.mark(0@0).reverse();
        strings_s2q := nil;
        var oid_item := oid_oid.leftfetchjoin(item);
        var oid_item_backup := oid_item;	#.copy();
        oid_item := oid_item.tunique().mark(0@0).reverse();
        var oid_str := oid_item.leftfetchjoin(str_values);
        oid_item := nil;
        var prop_name := Tprop_ns.ord_uselect("");
        prop_name := Tprop_loc.semijoin(prop_name);
        oid_str := oid_str.union(textNodes.tunique().project(oid(nil)).reverse());
        var str_oid := oid_str.reverse().kdiff(prop_name.reverse());
        oid_str := nil;
        prop_name := nil;
        oid_str := str_oid.mark(oid(Tprop_loc.count())).reverse();
        str_oid := nil;
        Tprop_loc.insert(oid_str);
        oid_str := oid_str.project("");
        Tprop_ns.insert(oid_str);
        oid_str := nil;
        prop_name := Tprop_ns.ord_uselect("");
        prop_name := Tprop_loc.semijoin(prop_name);
        oid_str := oid_oid.leftfetchjoin(oid_item_backup);
        oid_oid := nil;
        oid_str := oid_str.leftfetchjoin(str_values);
1.print();
        oid_item_backup := nil;
2.print();
        oid_str := merged_union(textNodes, oid_str).fetch(0);
        var oid_prop := oid_str.leftjoin(prop_name.reverse());
        oid_str := nil;
        prop_name := nil;
        item := oid_prop;
        oid_prop := nil;
3.print();
} # end of getQName ()
print(iter,pos,item,kind);
iter := nil;
pos := nil;
item := nil;
kind := nil;
