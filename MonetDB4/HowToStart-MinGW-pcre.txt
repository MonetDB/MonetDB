Compiling MonetDB with PCRE
===========================

.. This document is written in reStructuredText (see
   http://docutils.sourceforge.net/ for more information).
   Use ``rst2html.py`` to convert this file to HTML.

It is possible to compile MonetDB with support for the
`Perl-Compatible Regular Expression`__ (PCRE) library.  We have tried
it with pcre-6.2, downloadable from http://www.pcre.org.

__ http://www.pcre.org

Extract the sources and apply the patch at the bottom of this file.
This patch fixes some problems in the ``Makefile`` (actually
``Makefile.in`` from which the ``Makefile`` is derived) so that PCRE
can compile using `Cygwin`__/`MinGW`__.

__ http://www.cygwin.com/
__ http://www.mingw.org/

In order to compile and install the PCRE library, I use the following
commands::

 mkdir MinGW
 cd MinGW
 ../configure --host=i386-pc-mingw32 \
              CC='gcc -mwin32 -mno-cygwin' \
              --enable-utf8 \
              --prefix="$HOME/MinGW"
 make
 make install

Once the PCRE library is installed, you can configure MonetDB to use
this library.  Follow the instructions in `HowToStart-MinGW.txt`__,
but replace the configure option ``--without-pcre`` with::

	--with-pcre="$HOME/MinGW"

(the argument should be the same as the argument to the ``--prefix``
option above).

__ ???

Here is the patch for ``Makefile.in``.  Apply it using the ``patch``
command.

::

 --- Makefile.in-	2005-08-01 11:58:12.000000000 +0200
 +++ Makefile.in	2005-08-10 13:31:12.203125000 +0200
 @@ -174,11 +174,11 @@
  all:            libpcre.la @POSIX_LIB@ pcretest@EXEEXT@ pcregrep@EXEEXT@ @MAYBE_CPP_TARGETS@ @ON_WINDOWS@ winshared
  
  pcregrep@EXEEXT@: libpcre.la pcregrep.@OBJEXT@ @ON_WINDOWS@ winshared
 -		$(LINK) -o pcregrep@EXEEXT@ pcregrep.@OBJEXT@ libpcre.la
 +		$(LINK) -o pcregrep@EXEEXT@ pcregrep.@OBJEXT@ -lpcre
  
  pcretest@EXEEXT@: libpcre.la @POSIX_LIB@ pcretest.@OBJEXT@ @ON_WINDOWS@ winshared
  		$(LINK) $(PURIFY) $(EFENCE) -o pcretest@EXEEXT@  pcretest.@OBJEXT@ \
 -		libpcre.la @POSIX_LIB@
 +		-lpcre @POSIX_LIB@
  
  pcrecpp_unittest@EXEEXT@: libpcrecpp.la pcrecpp_unittest.@OBJEXT@ @ON_WINDOWS@ winshared
  		$(CXXLINK) $(PURIFY) $(EFENCE) -o pcrecpp_unittest@EXEEXT@  pcrecpp_unittest.@OBJEXT@ \
 @@ -199,12 +199,12 @@
  
  libpcreposix.la: libpcre.la pcreposix.@OBJEXT@
  		-rm -f libpcreposix.la
 -		$(LINKLIB) -rpath $(LIBDIR) libpcre.la -version-info \
 +		$(LINKLIB) -rpath $(LIBDIR) -lpcre -version-info \
  		'$(PCREPOSIXLIBVERSION)' -o libpcreposix.la pcreposix.lo
  
  libpcrecpp.la: libpcre.la $(CPPOBJ)
  		-rm -f libpcrecpp.la
 -		$(CXXLINKLIB) -rpath $(LIBDIR) libpcre.la -version-info \
 +		$(CXXLINKLIB) -rpath $(LIBDIR) -lpcre -version-info \
  		'$(PCRECPPLIBVERSION)' -o libpcrecpp.la $(CPPLOBJ)
  
  # Note that files generated by ./configure and by dftables are in the current
 @@ -372,8 +372,8 @@
  .libs/@WIN_PREFIX@pcreposix.dll: libpcreposix.la libpcre.la
  	$(CC) $(CFLAGS) -shared -o $@ \
  	-Wl,--whole-archive .libs/libpcreposix.a \
 -	-Wl,--out-implib,.libs/@WIN_PREFIX@pcreposix.dll.a \
 -	-Wl,--output-def,.libs/@WIN_PREFIX@libpcreposix.dll-def \
 +	-Wl,--out-implib,.libs/libpcreposix.dll.a \
 +	-Wl,--output-def,.libs/@WIN_PREFIX@pcreposix.dll-def \
  	-Wl,--export-all-symbols \
  	-Wl,--no-whole-archive .libs/libpcre.a
  	sed -e "s#dlname=''#dlname='../bin/@WIN_PREFIX@pcreposix.dll'#" \
 @@ -388,8 +388,8 @@
  .libs/@WIN_PREFIX@pcrecpp.dll: libpcrecpp.la libpcre.la
  	$(CXX) $(CXXFLAGS) -shared -o $@ \
  	-Wl,--whole-archive .libs/libpcrecpp.a \
 -	-Wl,--out-implib,.libs/@WIN_PREFIX@pcrecpp.dll.a \
 -	-Wl,--output-def,.libs/@WIN_PREFIX@libpcrecpp.dll-def \
 +	-Wl,--out-implib,.libs/libpcrecpp.dll.a \
 +	-Wl,--output-def,.libs/@WIN_PREFIX@pcrecpp.dll-def \
  	-Wl,--export-all-symbols \
  	-Wl,--no-whole-archive .libs/libpcre.a
  	sed -e "s#dlname=''#dlname='../bin/@WIN_PREFIX@pcrecpp.dll'#" \
 @@ -407,10 +407,10 @@
  	$(mkinstalldirs) $(DESTDIR)$(BINDIR)
  	$(INSTALL) .libs/@WIN_PREFIX@pcre.dll $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcre.dll
  	$(INSTALL) .libs/@WIN_PREFIX@pcreposix.dll $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcreposix.dll
 -	$(INSTALL) .libs/@WIN_PREFIX@libpcreposix.dll.a $(DESTDIR)$(LIBDIR)/@WIN_PREFIX@libpcreposix.dll.a
 -	$(INSTALL) .libs/@WIN_PREFIX@libpcre.dll.a $(DESTDIR)$(LIBDIR)/@WIN_PREFIX@libpcre.dll.a
 +	$(INSTALL) .libs/libpcreposix.dll.a $(DESTDIR)$(LIBDIR)/libpcreposix.dll.a
 +	$(INSTALL) .libs/libpcre.dll.a $(DESTDIR)$(LIBDIR)/libpcre.dll.a
  	$(INSTALL) .libs/@WIN_PREFIX@pcrecpp.dll $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcrecpp.dll
 -	$(INSTALL) .libs/@WIN_PREFIX@libpcrecpp.dll.a $(DESTDIR)$(LIBDIR)/@WIN_PREFIX@libpcrecpp.dll.a
 +	$(INSTALL) .libs/libpcrecpp.dll.a $(DESTDIR)$(LIBDIR)/libpcrecpp.dll.a
  	-strip -g $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcre.dll
  	-strip -g $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcreposix.dll
  	-strip -g $(DESTDIR)$(BINDIR)/@WIN_PREFIX@pcrecpp.dll
