stdout of test 'str` in directory 'src/modules/plain` itself:


# 14:57:28 >  
# 14:57:28 >  Mtimeout -timeout 60 Mserver "--config=/ufs/boncz/MonetDB/linux/etc/monet.conf" --debug=10 --set "monet_mod_path=/ufs/boncz/MonetDB/linux/lib/MonetDB" --set "gdk_dbfarm=/ufs/boncz/MonetDB/linux/var/MonetDB/dbfarm" --set "sql_logdir=/ufs/boncz/MonetDB/linux/var/MonetDB/log" --set mapi_port=52524 --set sql_port=56156 --set monet_prompt= --trace --dbname=mTests_src_modules_plain  < str.milM
# 14:57:28 >  

# Monet Database Server V4.3.13
# Copyright (c) 1993-2004, CWI. All rights reserved.
# compiled for i686-pc-linux-gnu/32bit; dynamically linked.
module("str");

setoid(oid(20000000));
var i1 := "This is a test";
var i2 := "of the str atomic type";

(("concat an int "+1)+" with a string "+i1+(" with an dbl "+dbl(1.0))).print(); 
[ "concat an int 1 with a string This is a test with an dbl 1" ]
(("concat an int "+1) + " with a string").print(); 
[ "concat an int 1 with a string" ]

length( i1 ).print();
[ 14 ]
var sres := (i1 + " ") + i2;
sres.print();
[ "This is a test of the str atomic type" ]
var len := length(sres);
string( sres, 10).print();
[ "test of the str atomic type" ]
string( sres, -10).print();
[ "tomic type" ]
string( sres, 10, len - 10 ).print();
[ "test of the str atomic type" ]
string( sres, 10, 10 ).print();
[ "test of th" ]
string( sres, -10, 10 ).print();
[ "tomic type" ]
string( sres, -10, 20 ).print();
[ "tomic type" ]
string( sres, 10, len).print();
[ "test of the str atomic type" ]
string( sres, len, 10).print();
[ "" ]
string( sres, -(len), 10).print(); 
[ "This is a " ]
string( sres, -(len + 5), 10).print(); 
[ "This " ]
chrAt( sres, 5 ).print();
[ 'i' ]
chrAt( sres, -3).print();
[ nil ]
chrAt( sres, len + 20).print();
[ nil ]
chrAt( sres, len).print();
[ nil ]
chrAt( sres, len - 1).print();
[ 'e' ]
chrAt( sres, 0).print();
[ 'T' ]
startsWith( i2, "of the" ).print();
[ true ]
startsWith( i2, i2 ).print();
[ true ]
startsWith( i2, "k" ).print();
[ false ]
endsWith( i2, "type" ).print();
[ true ]
endsWith( i2, i2 ).print();
[ true ]
endsWith( i2, "k" ).print();
[ false ]
toLower( i1 ).print();
[ "this is a test" ]
toUpper( i1 ).print();
[ "THIS IS A TEST" ]
search( "Hello this is a test for search", 'a' ).print();
[ 14 ]
r_search( "Hello this is a test for search", 'a' ).print();
[ 27 ]
search( "Hello this is a test for search", "ar" ).print();
[ 27 ]
r_search( "Hello this is a test for search", "ar" ).print();
[ 27 ]
search( "Hello this is a test for search", "is" ).print();
[ 8 ]
r_search( "Hello this is a test for search", "is" ).print();
[ 11 ]
search( "Hello this is a test for search", "Hello" ).print();
[ 0 ]
r_search( "Hello this is a test for search", "Hello" ).print();
[ 0 ]
search( "Hello this is a test for search", "arch" ).print();
[ 27 ]
r_search( "Hello this is a test for search", "arch" ).print();
[ 27 ]
search( "Hello this is a test for search", "xxx" ).print();
[ -1 ]
r_search( "Hello this is a test for search", "yyy" ).print();
[ -1 ]


trim("   f ").print();
[ "f" ]
trim("abc").print();
[ "abc" ]
trim("   x").print();
[ "x" ]
trim("x   ").print();
[ "x" ]
trim("").print();
[ "" ]
trim(str(nil)).print();
[ nil ]

substitute("A.B.C",".","\\.",false).print();
[ "A\\.B.C" ]
substitute("A.B.C",".","\\.",true).print();
[ "A\\.B\\.C" ]

translate("bar","abc","ABC").print();
[ "BAr" ]
translate("--aaa--","abc-","ABC").print();
[ "AAA" ]
translate("abcdabc","abc","AB").print();
[ "ABdAB" ]
translate(str(nil),"abc","ABC").print();
[ nil ]
translate("bar",str(nil),"ABC").print();
[ nil ]
translate("bar","abc",str(nil)).print();
[ nil ]
translate("","abc","ABC").print();
[ "" ]
translate("abcdabc","","AB").print();
[ "abcdabc" ]
translate("abcdabc","abc","").print();
[ "d" ]
translate("abcdabc","abc","\303\244B").print();
[ "äBdäB" ]

#unicode tests
var i := 0;
while((i :+= 1) < 65535) {
  var t := unicode(i) + "je";
  var s := "test" + t;
  var u := s + " ";
  var v := " " + s;
  if (s.chrAt(3) != 't') printf("bug1 in chrAt at u%04x (=u%04x)\n", i, int(s.chrAt(i)));
  if (s.chrAt(5) != 'j') printf("bug2 in chrAt at u%04x (=u%04x)\n", i, int(s.chrAt(i)));
  if (i < 128) {
    if (isnil(s.chrAt(4))) {
      printf("char u%04x is nil\n", i);
    } else if (s.chrAt(4) != chr(i)) {
      printf("bug3 in chrAt at u%04x (=u%04x)\n", i, int(s.chrAt(4)));
    }
  } else {
    if (not(isnil(s.chrAt(4)))) printf("bug4 in chrAt at u%04x (=u%04x)\n", i, int(s.chrAt(i)));
    if (s.search('j') != 5) printf("bug in s.searchChr at u%04x (=%d)\n", i, s.search('j'));
    if (s.r_search('t') != 3) printf("bug in s.r_searchChr at u%04x (=%d)\n", i, s.r_search('t'));
  }
  if (s.unicodeAt(4) != i) printf("bug in unicodeAt at u%04x (=u%04x)\n", i, s.unicodeAt(4));
  if (s.length() != 7) printf("bug in length at u%04x (=%d)\n", i, s.length());
  if (s.toUpper().toLower() != s.toLower()) printf("nonreversible toUpper/toLower at u%04x\n", i);
  if (s.toLower().toUpper() != s.toUpper()) printf("nonreversible toLower/toUpper at u%04x\n", i);
  if (s.search(t) != 4) printf("bug1 in s.search at u%04x (=%d)\n", i, s.search(t));
  if (s.search("je") != 5) printf("bug2 in s.search at u%04x (=%d)\n", i, s.search("je"));
  if (s.r_search(t) != 4) printf("bug1 in s.r_search at u%04x (=%d)\n", i, s.r_search(t));
  if (s.r_search("je") != 5) printf("bug2 in s.r_search at u%04x (=%d)\n", i, s.r_search("je"));
  if (s.string(4) != t) printf("bug1 in stringtail at u%04x (=%s)\n", i, s.string(4));
  if (s.string(5) != "je") printf("bug2 in stringtail at u%04x (=%s)\n", i, s.string(5));
  if (s.string(4,3) != t) printf("bug1 in substring at u%04x (=%s)\n", i, s.string(4,2));
  if (s.string(5,2) != "je") printf("bug2 in substring at u%04x (=%s)\n", i, s.string(5,2));
  if (v.ltrim() != s) printf("bug in ltrim at u%04x (=%s)\n", i, u.ltrim());
  if (u.rtrim() != s) printf("bug in rtrim at u%04x (=%s)\n", i, v.ltrim());
  if (not(startsWith(u,s))) printf("bug in startsWith at u%04x\n", i);
  if (not(endsWith(v,s))) printf("bug in endsWith at u%04x\n", i);
}
nonreversible toUpper/toLower at u00b5
nonreversible toLower/toUpper at u0130
nonreversible toUpper/toLower at u0131
nonreversible toUpper/toLower at u017f
nonreversible toUpper/toLower at u0345
nonreversible toUpper/toLower at u03c2
nonreversible toUpper/toLower at u03d0
nonreversible toUpper/toLower at u03d1
nonreversible toUpper/toLower at u03d5
nonreversible toUpper/toLower at u03d6
nonreversible toUpper/toLower at u03f0
nonreversible toUpper/toLower at u03f1
nonreversible toLower/toUpper at u03f4
nonreversible toUpper/toLower at u03f5
nonreversible toUpper/toLower at u1e9b
nonreversible toUpper/toLower at u1fbe
nonreversible toLower/toUpper at u2126
nonreversible toLower/toUpper at u212a
nonreversible toLower/toUpper at u212b
quit();

# 14:57:35 >  
# 14:57:35 >  Done.
# 14:57:35 >  

