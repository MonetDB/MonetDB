<!--
The contents of this file are subject to the MonetDB Public
License Version 1.0 (the "License"); you may not use this file
except in compliance with the License. You may obtain a copy of
the License at
http://monetdb.cwi.nl/Legal/MonetDBLicense-1.0.html

Software distributed under the License is distributed on an "AS
IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
implied. See the License for the specific language governing
rights and limitations under the License.

The Original Code is the Monet Database System.

The Initial Developer of the Original Code is CWI.
Portions created by CWI are Copyright (C) 1997-2004 CWI.
All Rights Reserved.
-->

<html>
<head>
<title> HowToStart with MonetDB</title>
</head>
<body>
<h3>HowToStart with MonetDB</h3>
<p>
This document helps you to install the MonetDB source and compile it.
Once succeeded, refer to doc/MonetDB.html for the user documentation 
generated as part of the process.
</p>
<p>
This document assumes that you are planning to compile and install
MonetDB on a Unix system (e.g., Linux, IRIX, Solaris, AIX, MacOS
X/Darwin, or CYGWIN).
For compilation and installation on a native Windows system (NT, 2000, XP)
see the instructions in the file 
<a href="http://monetdb.cwi.nl/GetGoing/Setup/MonetDB/Windows/index.html">HowToStart-Win32.txt</a>.
</p>


<h4>Prerequisites:</h4>
<table>
<tr><td valign=top><i>CVS</i></td>
<td>
	You need to have a working CVS.  For instructions, see
	<a href="http://sourceforge.net/docman/?group_id=1">
	docman </a> and look under the
	heading CVS Instructions.
</td></tr>
<tr><td valign=top><i>Python</i></td><td>
	MonetDB uses Python (version 2.0.0 or better) during
	configuration of the software.  See <a href="http://www.python.org/">
	python.org</a> for more information.
</td></tr>

<tr><td colspan=2><i>autoconf/automake/libtool</i> </td></tr>
<tr><td></td><td>
	MonetDB uses GNU 
	<a href="http://www.gnu.org/software/autoconf/">autoconf</a> (&gt;= 2.53), 
	<a href="http://www.gnu.org/software/automake/"> automake </a>(&gt;= 1.5), and
	<a href="http://www.gnu.org/software/libtool/">
libtool</a> (&gt;= 1.4) during configuration of the software.
	Libtool is also used during the build.
</td></tr>
<tr><td colspan=2><i>standard software development tools</i></td></tr>
<tr><td></td><td>
	To compile MonetDB, you also need to have a the following 
	standard software development tools installed and ready for use
	on you system:
	 - a C/C++ compiler (e.g., GNU's gcc/g++)
	 - a lexical analyzer generator (e.g., "lex" or "flex")
	 - a parser generator (e.g., "yacc" or "bison")
	 - GNU make ("gmake") (native make's on, e.g., IRIX and Solaris
	   usually don't work)
</td></tr>

<tr><td colspan=2><i>dlcompat (MacOS X/Darwin, only)</i></td></tr>
<tr><td></td><td>	MacOS X/Darwin itself does not support dlopen, however, there's
	a third-party library called dlcompat from Fink that provides
	the respective functionality.  MonetDB requires 
	<a href="http://fink.sourceforge.net/pdb/package.php/dlcompat">
	dlcompat</a> to be installed on MacOS X/Darwin.
</td></tr>

<tr><td colspan-2><i>disk space</i></td></tr>
<tr><td></td><td>
	After downloading, MonetDB takes up about 40 MB of disk space;
	compilation adds another 70 MB.  Testing takes about 45 MB, and
	the installation about 20 MB (not including any databases).
</td></tr>
</table>
<h4>Getting the Software:</h4>
<p>
This command should be done once.  It records a password on the local
machine to be used for all subsequent CVS accesses with this server.
<pre>
 cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/monetdb login
</pre>

Just type RETURN when asked for the password.

Then get the software by using the command:
<pre>
 cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/monetdb checkout MonetDB
</pre>
This will create a directory MonetDB in your current working directory.

Also see <a href="http://sourceforge.net/cvs/?group_id=56967">
SourceForge documentation</a> for more information.


</p>
<h4>Configure and Make:</h4>
<p>
Before executing the following steps, make sure that your
shell-environment (especially variables like "PATH" and
"LD_LIBRARY_PATH") is setup, thus that the tools listed above can be
found. 
("Bash"-users at CWI and DD are welcome to simply 
  "source conf/conf.bash".
 This sets the proper environment and even provides aliases
 "configure_MonetDB" & "Mtest_MonetDB" for convenience.
 See conf/conf.bash itself for more details.)

In the top-level directory of MonetDB type the command:
<pre>
 ./bootstrap
</pre>

Then in any directory (preferably a *new empty* directory and *not* in the
MonetDB top-level directory) give the command

<pre>
 .../configure [<options>]
</pre>

where ... is replaced with the (absolute or relative) path to the
MonetDB top-level directory.
The directory where you execute configure is the place where all
intermediate source and object files are generated during compilation
via "make".

By default, MonetDB is eventually (i.e., during "make install"; see
below) installed to /usr/local/.  To choose another target directory, 
you need to call
<pre>
 .../configure --prefix=<prefixdir> [<options>]
</pre>
A sample of other useful configure options is:
<table>
<tr><td>  --enable-debug          </td><td>enable full debugging default=off </td></tr>
<tr><td>  --enable-optimize       </td><td>enable extra optimization default=off </td></tr>
<tr><td>  --enable-warning        </td><td>enable extended compiler warnings default=off </td></tr>
<tr><td>  --enable-profile        </td><td>enable profiling default=off </td></tr>
<tr><td>  --enable-instrument     </td><td>enable instrument default=off </td></tr>
<tr><td>  --with-gcc=[compiler]   </td><td>which C compiler to use
                          ("yes" = gcc/g++, 
                           "no"  = system-specific C/C++ compiler,
                           <other-compiler-name>) </td></tr>
<tr><td>  --with-gxx=[compiler]   </td><td>which C++ compiler to use </td></tr>
<tr><td>  --with-bits=[#bits]     </td><td>specify number of bits (32 or 64) </td></tr>
</table>
Use the --help option of configure to find out more about configure
options.

In the same directory (where you called configure) give the command
<pre>
 make
</pre>

to compile the source code.

On my lightly loaded, dual 1.4 GHz Athlon Linux system, configure
takes about 30 seconds, and make about 5 to 10 minutes, depending on
the optimization level chosen during configure.
</p>


<h4>Testing the Build:</h4>
<p>
If make went successfully, you can try
<pre>
 make check
</pre>

This will do a lot of tests, some are unfortunately still expected to
fail, but most should go successfully.  At the end of the output there
is a reference to an HTML file which is created by the test process and
shows the test results.  

Testing takes about 46 MB of disk space in the build directory.

Running the tests takes about 13 minutes on my system.
</p>

<h4>Installing:</h4>
<p>
Give the command
<pre>
 make install
</pre>

By default (if no --prefix option was given to configure above), this
will install in /usr/local/.  Make sure you have appropriate privileges.
</p>

<h4>Testing the Installation:</h4>
<p>
Make sure that /usr/local/bin (respectively <prefixdir>/bin, where
<prefixdir> is the directory you specified with --prefix when calling
configure) is in your PATH.

In the MonetDB top-level directory issue the command
<pre>
 Mtest.py -r
</pre>

This should produce much the same output as make check above, but uses
the installed version of MonetDB.

You need write permissions on part of the installation directory for
this command: it will create subdirectories var/dbfarm and Tests.
</p>

<h4>Documentation:</h4>
<p>
The documentation starts in <prefixdir>/doc/MonetDB.html
</p>
<p>
NOTE: the current 'make install' does not yet generate this
      documentation to do this manually, execute *after* successful
      'make install'.  In the top-level directory of the MonetDB build
      tree, call
<pre>
 make html
</pre>
</p>


<h4>Troubleshooting:</h4>
<p>
Bootstrap fails if any of the requisite programs can not be found or
is an incompatible version.

Bootstrap adds files to the source directory, so it must have write
permissions.

During bootstrap, warnings like
<pre>
	Remember to add `AC_PROG_LIBTOOL' to `configure.in'.
	You should add the contents of `/usr/share/aclocal/libtool.m4' to `aclocal.m4'.
	configure.in:37: warning: do not use m4_patsubst: use patsubst or m4_bpatsubst
	configure.in:104: warning: AC_PROG_LEX invoked multiple times
	configure.in:334: warning: do not use m4_regexp: use regexp or m4_bregexp
	automake/aclocal 1.6.3 is older than 1.7.
	Patching aclocal.m4 for Intel compiler on Linux (icc/ecc).
	patching file aclocal.m4
	Hunk #1 FAILED at 2542.
	1 out of 1 hunk FAILED -- saving rejects to file aclocal.m4.rej
	patching file aclocal.m4
	Hunk #1 FAILED at 1184.
	Hunk #2 FAILED at 2444.
	Hunk #3 FAILED at 2464.
	3 out of 3 hunks FAILED -- saving rejects to file aclocal.m4.rej
</pre>
might occur.
For some technical reasons, it's hard to completely avoid them. However,
it is usually save to ignore them and simply proceed with the usual 
compilation procedure. Only in case the subsequent configure or make
do fail, these warning might have to be take more serious; in any case, 
you should include the e bootstrap output in whenever you report (se below)
compilation problems.

Configure will fail if certain essential programs can't be found or
certain essential tasks (such as compiling a C program) can't be
executed.  The problem will usually be clear from the error message.

E.g., if configure cannot find package XYZ, it is either not installed
on your machine, or it is not installed in places that configure
usually searches (i.e., /usr, /usr/local).  In the first case, you need
to install package XYZ before you can configure, make, and install
MonetDB.  In the latter case, you need to tell configure via
"--with-XYZ=&lt;DIR&gt;" where to find packages XYZ on your machine. 
configure then looks for the respective header files in &lt;DIR&gt;/include,
and for the respective libraries in &lt;DIR&gt;/lib.

Bugs and other problems with compiling or running MonetDB should be
reported using the respective bug-tracking system at 
<a href="https://sourceforge.net/tracker/?group_id=56967&atid=482468">
SourceFORGE</a> (preferred) or emailed
to <a href="mailto:monet@cwi.nl">monet@cwi.nl</a>.  See also the MonetDB
<a href="http://monetdb.cwi.nl/Development/Bugtracker/index.html">
BugTracker. </a>
</p>

<h4>Running MonetDB with valgrind on Linux</h4>
<p>
In case you intend (or need) to run MonetDB with the memory debugging and
profiling tool "valgrind", you need to take care to disable the 
gdk_alloc_map. So you can callgrind (valgrinds profiling tool) 
MonetDB with: 
<pre>
    valgrind --tool=callgrind Mserver --set gdk_alloc_map=no
</pre>
</p>
</body>
</html>
